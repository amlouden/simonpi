#!/bin/bash

GUESTPORT=22
EXTERPORT=2222
GUESTPORT1=80
EXTERPORT1=8080

# Must be root for some ops
checkRoot() {
	if [[ $(sudo whoami) != "root" ]]; then
		echo -e "[$FAIL] Sim-on-Pi will not continue"
		echo -e "[$FAIL] Please type your user password or run this script as root"
		exit 1
	fi
}

finalizeIt() {
	presetsDel
	umountParts
	umountImg
	checkQemu
	if [ "$DOCKER" = "0" ] && [ "$QEMUISRUNNING" = "0" ]; then
		killNetwork
	fi
}

initChecks() {
	checkDocker

	if [ "$DOCKER" = "0" ]; then
		checkRoot
		checkTap
		createNetwork
		generateMAC
		NETWORKCMD=" -net nic,macaddr=$MACADDR -net tap,ifname=$TAP,script=no,downscript=no"
	else
		generateMAC
		NETWORKCMD=" -net nic,macaddr=$MACADDR -net user,hostfwd=tcp::$EXTERPORT-:$GUESTPORT,hostfwd=tcp::$EXTERPORT1-:$GUESTPORT1"
	fi
}
